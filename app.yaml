runtime: php82
service: default

env_variables:
  DB_HOST: "34.52.242.229"
  DB_NAME: "resto_platform"
  DB_USER: "root"
  DB_PASS: "781155609"
  BASE_URL: "https://sencommandes.ew.r.appspot.com/"
  # Ajoutez cette variable pour le chemin de base des images
  IMG_BASE_PATH: "assets/img/"

# Gestion des fichiers statiques - CONFIGURATION CORRIGÉE
handlers:
  # Servir les fichiers CSS, JS, images directement
  - url: /(.+\.(gif|png|jpg|jpeg|css|js|ico|webp|svg))$
    static_files: \1
    upload: .+\.(gif|png|jpg|jpeg|css|js|ico|webp|svg)$
    application_readable: true

  # Servir le dossier assets complet
  - url: /assets
    static_dir: assets
    application_readable: true

  # Servir le dossier uploads complet
  - url: /uploads
    static_dir: uploads
    application_readable: true

  # Redirection pour les anciens chemins (compatibilité)
  - url: /resto_plateform/assets/(.*)
    static_files: assets/\1
    upload: assets/.*
    application_readable: true

  # Toutes les autres URLs sont gérées par index.php
  - url: /.*
    script: auto
    secure: always

# Configuration de mise à l'échelle
automatic_scaling:
  target_cpu_utilization: 0.65
  min_instances: 1
  max_instances: 5
  min_pending_latency: 30ms
  max_pending_latency: 100ms
  max_concurrent_requests: 50

# Configuration PHP spécifique
runtime_config:
  document_root: .

# Health checking
health_check:
  enable_health_check: True
  check_interval_sec: 5
  timeout_sec: 4
  unhealthy_threshold: 2
  healthy_threshold: 2
